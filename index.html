<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M√©t√©o Mobile</title>
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: sans-serif;
      background-image: url(https://www.francebleu.fr/s3/cruiser-production/2023/06/f21ac4df-5c79-4db6-9152-9b59aaa87aeb/1200x680_sc_gettyimages-1435906430.jpg);
      color: white;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      position: relative;
    }

    .container {
      max-width: 480px;
      width: 100%;
    }
    h1 {
      font-size: 26px;
      margin-bottom: 5px;
      text-align: center;
    }
    .temp {
      font-size: 60px;
      font-weight: bold;
      text-align: center;
    }
    .description {
      font-size: 18px;
      margin-bottom: 10px;
      text-align: center;
      text-transform: capitalize;
    }
    .section {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      margin-top: 15px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }
    .box {
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
    }
    .box h3 {
      margin: 0 0 8px 0;
      font-weight: bold;
    }
    .forecast-item {
      display: inline-block;
      width: 40px;
      margin: 0 5px;
      font-size: 14px;
      text-align: center;
    }
    .forecast-item img {
      width: 40px;
      height: 40px;
    }
    input[type=text], button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
    }
    button {
      background: #2874f0;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background: #1b5edb;
    }
    .error {
      text-align:center;
      color: #ff4c4c;
      margin-top: 10px;
      font-weight: bold;
    }

    /* Menu d√©roulant */
    .menu-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 24px;
      cursor: pointer;
      z-index: 1000;
    }
    .dropdown-menu {
      position: absolute;
      top: 60px;
      left: 20px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(6px);
      border-radius: 8px;
      padding: 10px 0;
      display: none;
      flex-direction: column;
      min-width: 150px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    .dropdown-menu a {
      color: white;
      padding: 10px 15px;
      text-decoration: none;
      display: block;
      font-size: 16px;
    }
    .dropdown-menu a:hover {
      background: rgba(255, 255, 255, 0.25);
    }
  </style>
</head>
<body>
      
  <!-- MENU DEROULANT -->
  <div class="menu-toggle" onclick="toggleMenu()">‚ò∞</div>
  <div class="dropdown-menu" id="dropdownMenu">
    <a href="support.html">üõ†Ô∏è Support</a>
    <a href="dev.html">üë®‚Äçüíª Le d√©veloppeur</a>
    <a href="update.html">üîÑ Mise √† jour</a>
  </div>  

  <!-- CONTENU PRINCIPAL -->
  <div class="container">
    <h1 id="city">Veuillez saisir une ville</h1>
    <div class="temp" id="temp">--¬∞</div>
    <div class="description" id="desc">---</div>

    <input id="ville" type="text" placeholder="Ex : Paris" />
    <button id="btnChercher">Chercher</button>
    <div class="error" id="error"></div>

    <div class="section">
      <div class="grid">
        <div class="box">
          <h3>Humidit√©</h3>
          <div id="humidity">--%</div>
        </div>
        <div class="box">
          <h3>Vent</h3>
          <div id="wind">-- km/h</div>
        </div>
        <div class="box" style="grid-column: span 2;">
          <h3>Pr√©visions 24h</h3>
          <div id="forecast24h"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- JS DU MENU -->
  <script>
    function toggleMenu() {
      const menu = document.getElementById("dropdownMenu");
      menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }
    document.addEventListener("click", function(e) {
      const menu = document.getElementById("dropdownMenu");
      const toggle = document.querySelector(".menu-toggle");
      if (!menu.contains(e.target) && !toggle.contains(e.target)) {
        menu.style.display = "none";
      }
    });
  </script>

  <!-- JS METEO -->
  <script>
    const API_KEY = "f570ba4a8945e02cc0cdf9bb166d14e1";
    const elements = {
      city: document.getElementById("city"),
      temp: document.getElementById("temp"),
      desc: document.getElementById("desc"),
      wind: document.getElementById("wind"),
      humidity: document.getElementById("humidity"),
      error: document.getElementById("error"),
      villeInput: document.getElementById("ville"),
      btnChercher: document.getElementById("btnChercher"),
      forecast24h: document.getElementById("forecast24h"),
    };

    function degToDirection(deg) {
      const directions = ["N", "NE", "E", "SE", "S", "SO", "O", "NO"];
      return directions[Math.round(deg / 45) % 8];
    }

    function formatHour(timestamp, timezoneOffset) {
      const date = new Date((timestamp + timezoneOffset) * 1000);
      return date.getUTCHours() + "h";
    }

    async function fetchWeatherData(ville) {
      if (!ville) {
        elements.error.textContent = "Merci de saisir une ville";
        return;
      }
      elements.error.textContent = "";
      elements.forecast24h.innerHTML = "Chargement...";

      try {
        const responseWeather = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(ville)}&appid=${API_KEY}&units=metric&lang=fr`);
        if (!responseWeather.ok) throw new Error("Ville non trouv√©e ou cl√© invalide");
        const dataWeather = await responseWeather.json();

        elements.city.textContent = dataWeather.name;
        elements.temp.textContent = `${Math.round(dataWeather.main.temp)}¬∞C`;
        elements.desc.textContent = dataWeather.weather[0].description;
        const speedKmh = (dataWeather.wind.speed * 3.6).toFixed(1);
        const direction = degToDirection(dataWeather.wind.deg);
        elements.wind.textContent = `${speedKmh} km/h ${direction}`;
        elements.humidity.textContent = dataWeather.main.humidity + "%";

        const responseForecast = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(ville)}&appid=${API_KEY}&units=metric&lang=fr`);
        if (!responseForecast.ok) throw new Error("Erreur r√©cup√©ration pr√©visions");
        const dataForecast = await responseForecast.json();

        elements.forecast24h.innerHTML = "";
        const timezoneOffset = dataForecast.city.timezone;

        dataForecast.list.slice(0, 8).forEach(item => {
          const hour = formatHour(item.dt, timezoneOffset);
          const icon = item.weather[0].icon;
          const temp = Math.round(item.main.temp);
          const div = document.createElement("div");
          div.className = "forecast-item";
          div.innerHTML = `
            ${hour}<br>
            <img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt=""><br>
            ${temp}¬∞
          `;
          elements.forecast24h.appendChild(div);
        });

      } catch (err) {
        elements.error.textContent = "Erreur : " + err.message;
        elements.city.textContent = "Ville introuvable";
        elements.temp.textContent = "--¬∞";
        elements.desc.textContent = "---";
        elements.wind.textContent = "---";
        elements.humidity.textContent = "--%";
        elements.forecast24h.innerHTML = "---";
      }
    }

    elements.btnChercher.addEventListener("click", () => {
      fetchWeatherData(elements.villeInput.value.trim());
    });
  </script>
</body>
</html>
