<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M√©t√©o Mobile</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url(https://img.freepik.com/photos-gratuite/nuages-blancs-sous-ciel-bleu-pendant-journee_417767-59.jpg?semt=ais_items_boosted&w=740);
      background-size: cover;
      background-position: center;
      color: white;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      position: relative;
      overflow-x: hidden;
    }

    .container {
      max-width: 480px;
      width: 100%;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.7);
    }

    h1 {
      font-size: 26px;
      margin-bottom: 10px;
      text-align: center;
      font-weight: 700;
      text-shadow: 0 0 8px rgba(0,0,0,0.6);
    }
    .temp {
      font-size: 64px;
      font-weight: 700;
      text-align: center;
      margin-bottom: 5px;
      text-shadow: 0 0 10px rgba(0,0,0,0.7);
    }
    .description {
      font-size: 18px;
      margin-bottom: 20px;
      text-align: center;
      text-transform: capitalize;
      font-weight: 600;
      text-shadow: 0 0 8px rgba(0,0,0,0.5);
    }

    .section {
      background: rgba(255,255,255,0.1);
      border-radius: 12px;
      padding: 15px;
      margin-top: 20px;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .box {
      background: rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      transition: background-color 0.3s ease;
      font-weight: 600;
      font-size: 15px;
      text-shadow: 0 0 3px rgba(0,0,0,0.4);
    }

    .box h3 {
      margin: 0 0 8px 0;
      font-weight: 700;
    }

    /* Bo√Ætes noir transparent */
    .black-box {
      background-color: rgba(0, 0, 0, 0.75) !important;
      color: white !important;
      text-shadow: none;
    }

    .forecast-item {
      display: inline-block;
      width: 48px;
      margin: 0 6px;
      font-size: 14px;
      text-align: center;
      user-select: none;
      font-weight: 600;
      text-shadow: 0 0 5px rgba(0,0,0,0.7);
    }

    .forecast-item img {
      width: 48px;
      height: 48px;
      filter: drop-shadow(0 0 2px rgba(0,0,0,0.6));
    }

    input[type=text], button {
      width: 100%;
      padding: 14px;
      margin-top: 10px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    input[type=text] {
      background: rgba(255,255,255,0.2);
      color: white;
      text-shadow: 0 0 5px rgba(0,0,0,0.8);
      border: 1px solid rgba(255,255,255,0.3);
    }

    input[type=text]:focus {
      box-shadow: 0 0 12px #2874f0;
      border-color: #2874f0;
      background: rgba(255,255,255,0.3);
    }

    button {
      background: #2874f0;
      color: white;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 0.03em;
      box-shadow: 0 6px 12px rgba(40,116,240,0.6);
      user-select: none;
    }

    button:hover, button:focus {
      background: #1b5edb;
      box-shadow: 0 8px 18px rgba(27,94,219,0.85);
      outline: none;
    }

    .error {
      text-align: center;
      color: #ff4c4c;
      margin-top: 10px;
      font-weight: 700;
      text-shadow: 0 0 5px rgba(255,0,0,0.8);
    }

    /* MENU HAMBURGER en haut droite */
    .menu-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      font-size: 28px;
      cursor: pointer;
      z-index: 1001;
      user-select: none;
      color: white;
      text-shadow: 0 0 5px rgba(0,0,0,0.8);
      background: rgba(0,0,0,0.3);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s ease;
    }
    .menu-toggle:hover {
      background: rgba(0,0,0,0.6);
    }

    .dropdown-menu {
      position: fixed;
      top: 65px;
      right: 15px;
      background: rgba(0,0,0,0.75);
      border-radius: 12px;
      padding: 10px 0;
      display: none;
      flex-direction: column;
      min-width: 160px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.7);
      z-index: 1000;
      user-select: none;
    }

    .dropdown-menu a {
      color: white;
      padding: 12px 20px;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      transition: background-color 0.25s ease;
    }

    .dropdown-menu a:hover,
    .dropdown-menu a:focus {
      background: #2874f0;
      outline: none;
    }

    /* Onglets villes sauvegard√©es en colonne √† gauche */
    #savedCities {
  position: static; /* plus fixe */
  
  padding: 12px 8px;
  border-radius: 14px;
  font-size: 14px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  max-height: 200px; /* ou une hauteur adapt√©e */
  overflow-y: auto;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
  user-select: none;
  margin-top: 15px; /* espace au-dessus */
  width: 100%; /* prendre toute la largeur du container */

    }
    #savedCities::-webkit-scrollbar {
      width: 6px;
    }
    #savedCities::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 6px;
    }

    #savedCities button {
      background: rgba(255, 255, 255, 0.9);
      color: #000000;
      border: none;
      padding: 10px 14px;
      border-radius: 14px;
      cursor: pointer;
      font-weight: 700;
      text-transform: uppercase;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      transition: background-color 0.3s ease, color 0.3s ease;
      white-space: nowrap;
      user-select: none;
    }
    #savedCities button:hover,
    #savedCities button:focus {
      background: #000000;
      color: white;
      outline: none;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.85);
    }

    /* Carte m√©t√©o */
    #map {
      height: 400px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(0,0,0,0.7);
      margin-top: 10px;
    }

    /* Scrollbar pour pr√©visions 24h s‚Äôil d√©passe */
    .section .forecast24h-scroll {
      overflow-x: auto;
      white-space: nowrap;
      padding-bottom: 8px;
      -webkit-overflow-scrolling: touch;
    }

  </style>
</head>

<body>


  <!-- MENU HAMBURGER -->
  <div class="menu-toggle" role="button" aria-label="Ouvrir le menu" tabindex="0" onclick="toggleMenu()" onkeydown="if(event.key==='Enter'){toggleMenu()}">‚ò∞</div>
  <nav class="dropdown-menu" id="dropdownMenu" role="menu" aria-hidden="true">
    <a href="support.html" role="menuitem" tabindex="-1">üõ†Ô∏è Support</a>
    <a href="dev.html" role="menuitem" tabindex="-1">üë®‚Äçüíª Le d√©veloppeur</a>
    <a href="update.html" role="menuitem" tabindex="-1">üîÑ Mise √† jour</a>
  </nav>

  <!-- CONTENU PRINCIPAL -->
  <main class="container" role="main" aria-live="polite">
    <h1 id="city">Veuillez saisir une ville</h1>
    <div class="temp" id="temp">--¬∞</div>
    <div class="description" id="desc">---</div>

    <input id="ville" type="text" placeholder="Ex : Paris" aria-label="Saisir une ville" autocomplete="off" />
    <button id="btnChercher" aria-label="Chercher la m√©t√©o">Chercher</button>

    <!-- Villes enregistr√©es sous le bouton Chercher -->
  <div id="savedCities" aria-label="Villes sauvegard√©es" style="margin-top: 15px;"></div>
  
    <div class="error" id="error" role="alert" aria-live="assertive"></div>

    <section class="section" aria-label="D√©tails m√©t√©o">
      <div class="grid">
        <div class="box black-box" aria-label="Humidit√©">
          <h3>Humidit√©</h3>
          <div id="humidity">--%</div>
        </div>
        <div class="box black-box" aria-label="Vent">
          <h3>Vent</h3>
          <div id="wind">-- km/h</div>
        </div>
        <div class="box black-box" style="grid-column: span 2;" aria-label="Pr√©visions 24 heures">
          <h3>Pr√©visions 24h</h3>
          <div id="forecast24h" class="forecast24h-scroll">---</div>
        </div>
      </div>
    </section>

    <!-- CARTE METEO EN BAS -->
    <section class="section" aria-label="Carte m√©t√©o temps r√©el">
      <h2 style="text-align:center;margin-bottom: 10px;">Carte m√©t√©o temps r√©el</h2>
      <div id="map" role="region" aria-label="Carte m√©t√©o"></div>
    </section>
  </main>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- JS MENU -->
  <script>
    const menuToggle = document.querySelector(".menu-toggle");
    const dropdownMenu = document.getElementById("dropdownMenu");

    function toggleMenu() {
      if (dropdownMenu.style.display === "flex") {
        dropdownMenu.style.display = "none";
        dropdownMenu.setAttribute("aria-hidden", "true");
      } else {
        dropdownMenu.style.display = "flex";
        dropdownMenu.setAttribute("aria-hidden", "false");
      }
    }
    document.addEventListener("click", function (e) {
      if (!dropdownMenu.contains(e.target) && !menuToggle.contains(e.target)) {
        dropdownMenu.style.display = "none";
        dropdownMenu.setAttribute("aria-hidden", "true");
      }
    });
  </script>

  <!-- JS METEO -->
  <script>
    const API_KEY = "f570ba4a8945e02cc0cdf9bb166d14e1";
    const elements = {
      city: document.getElementById("city"),
      temp: document.getElementById("temp"),
      desc: document.getElementById("desc"),
      wind: document.getElementById("wind"),
      humidity: document.getElementById("humidity"),
      error: document.getElementById("error"),
      villeInput: document.getElementById("ville"),
      btnChercher: document.getElementById("btnChercher"),
      forecast24h: document.getElementById("forecast24h"),
      savedCitiesContainer: document.getElementById("savedCities"),
    };

    // Gestion stockage local
    function getSavedCities() {
      const cities = localStorage.getItem("savedCities");
      return cities ? JSON.parse(cities) : [];
    }
    function saveCities(cities) {
      localStorage.setItem("savedCities", JSON.stringify(cities));
    }
    function addCityToSaved(city) {
      city = city.trim();
      if (!city) return;
      let cities = getSavedCities();
      if (!cities.includes(city)) {
        cities.push(city);
        saveCities(cities);
        renderSavedCities();
      }
    }
    function renderSavedCities() {
  const cities = getSavedCities();
  elements.savedCitiesContainer.innerHTML = "";
  if (cities.length === 0) {
    const span = document.createElement("span");
    span.textContent = "Aucune ville sauvegard√©e";
    span.style.color = "rgba(255,255,255,0.7)";
    span.style.fontStyle = "italic";
    elements.savedCitiesContainer.appendChild(span);
    return;
  }
  cities.forEach(city => {
    const container = document.createElement("div");
    container.style.display = "flex";
    container.style.justifyContent = "space-between";
    container.style.alignItems = "center";
    container.style.marginBottom = "6px";

    const btnCity = document.createElement("button");
    btnCity.textContent = city;
    btnCity.title = "Afficher la m√©t√©o pour " + city;
    btnCity.setAttribute("aria-label", "Afficher la m√©t√©o pour " + city);
    btnCity.style.flexGrow = "1";
    btnCity.style.marginRight = "8px";
    btnCity.addEventListener("click", () => {
      elements.villeInput.value = city;
      fetchWeatherData(city);
    });

    const btnDelete = document.createElement("button");
    btnDelete.textContent = "√ó";  // croix
    btnDelete.title = "Supprimer " + city;
    btnDelete.setAttribute("aria-label", "Supprimer " + city);
    btnDelete.style.fontSize = "12px";   // petite taille
btnDelete.style.padding = "0 4px";   // petit padding horizontal
btnDelete.style.lineHeight = "1";    // pour que ce soit bien compact
btnDelete.style.width = "18px";      // largeur fixe pour que ce soit carr√©
btnDelete.style.height = "18px";     // hauteur fixe
btnDelete.style.textAlign = "center"; 
btnDelete.style.borderRadius = "3px";  // un peu arrondi
btnDelete.style.background = "transparent";
btnDelete.style.color = "rgba(255,255,255,0.6)";
btnDelete.style.border = "none";
btnDelete.style.cursor = "pointer";
btnDelete.style.userSelect = "none";
btnDelete.style.transition = "color 0.3s";
    

    btnDelete.addEventListener("click", (e) => {
      e.stopPropagation(); // √©viter que √ßa d√©clenche l'affichage m√©t√©o
      removeCity(city);
    });

    container.appendChild(btnCity);
    container.appendChild(btnDelete);
    elements.savedCitiesContainer.appendChild(container);
  });
    }

    function removeCity(cityToRemove) {
  let cities = getSavedCities();
  cities = cities.filter(city => city !== cityToRemove);
  saveCities(cities);
  renderSavedCities();
}


    // Format heure locale HHh
    function formatHour(dtUnix, timezoneOffset) {
      const date = new Date((dtUnix + timezoneOffset) * 1000);
      const h = date.getUTCHours();
      return h.toString().padStart(2,"0") + "h";
    }

    // Direction du vent
    function degToDirection(deg) {
      const directions = ["N","NE","E","SE","S","SO","O","NO"];
      return directions[Math.round(deg / 45) % 8];
    }

    // Initialisation carte
    let map, marker;
    function initMap() {
      map = L.map("map").setView([48.8566, 2.3522], 11); // Paris par d√©faut, zoom 11
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
    }

    function updateMap(lat, lon, cityName) {
      if (!map) initMap();

      if (marker) {
        marker.setLatLng([lat, lon]);
      } else {
        marker = L.marker([lat, lon]).addTo(map);
      }
      // Zoom plus fort pour pr√©cision et centrage sans saut visuel
      map.flyTo([lat, lon], 13, {
        animate: true,
        duration: 1.2
      });
      marker.bindPopup(cityName).openPopup();
    }

    async function fetchWeatherData(ville) {
      if (!ville) {
        elements.error.textContent = "Merci de saisir une ville";
        return;
      }
      elements.error.textContent = "";
      elements.forecast24h.innerHTML = "Chargement...";

      try {
        const responseWeather = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(ville)}&appid=${API_KEY}&units=metric&lang=fr`);
        if (!responseWeather.ok) throw new Error("Ville non trouv√©e ou cl√© invalide");
        const dataWeather = await responseWeather.json();

        // Sauvegarde la ville
        localStorage.setItem("lastCity", dataWeather.name);
        addCityToSaved(dataWeather.name);

        elements.city.textContent = dataWeather.name;
        elements.temp.textContent = `${Math.round(dataWeather.main.temp)}¬∞C`;
        elements.desc.textContent = dataWeather.weather[0].description;
        const speedKmh = (dataWeather.wind.speed * 3.6).toFixed(1);
        const direction = degToDirection(dataWeather.wind.deg);
        elements.wind.textContent = `${speedKmh} km/h ${direction}`;
        elements.humidity.textContent = dataWeather.main.humidity + "%";

        const responseForecast = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${encodeURIComponent(ville)}&appid=${API_KEY}&units=metric&lang=fr`);
        if (!responseForecast.ok) throw new Error("Erreur r√©cup√©ration pr√©visions");
        const dataForecast = await responseForecast.json();

        elements.forecast24h.innerHTML = "";
        const timezoneOffset = dataForecast.city.timezone;

        dataForecast.list.slice(0, 8).forEach(item => {
          const hour = formatHour(item.dt, timezoneOffset);
          const icon = item.weather[0].icon;
          const temp = Math.round(item.main.temp);
          const div = document.createElement("div");
          div.className = "forecast-item";
          div.innerHTML = `${hour}<br><img src="https://openweathermap.org/img/wn/${icon}@2x.png" alt="${item.weather[0].description}"><br>${temp}¬∞`;
          elements.forecast24h.appendChild(div);
        });

        // Met √† jour la carte
        updateMap(dataWeather.coord.lat, dataWeather.coord.lon, dataWeather.name);

      } catch (err) {
        elements.error.textContent = "Erreur : " + err.message;
        elements.city.textContent = "Ville introuvable";
        elements.temp.textContent = "--¬∞";
        elements.desc.textContent = "---";
        elements.wind.textContent = "---";
        elements.humidity.textContent = "--%";
        elements.forecast24h.innerHTML = "---";
      }
    }

    // √âv√©nements
    elements.btnChercher.addEventListener("click", () => {
      fetchWeatherData(elements.villeInput.value);
    });
    elements.villeInput.addEventListener("keydown", e => {
      if (e.key === "Enter") {
        elements.btnChercher.click();
      }
    });

    window.addEventListener("load", () => {
      const lastCity = localStorage.getItem("lastCity");
      if (lastCity) {
        elements.villeInput.value = lastCity;
        fetchWeatherData(lastCity);
      }
      renderSavedCities();
      initMap();
    });
  </script>
</body>
</html>
